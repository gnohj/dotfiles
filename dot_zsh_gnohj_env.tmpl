#!/usr/bin/env bash
# Environment variables for gnohj's shell configuration
# This file is managed by chezmoi - DO NOT EDIT DIRECTLY
# Template: ~/.local/share/chezmoi/dot_zsh_gnohj_env.tmpl
#
# For secrets and machine-specific overrides, create:
#   ~/.zsh_gnohj_env.secrets (auto-generated from Chezmoi)
#   ~/.zsh_gnohj_env.local (gitignored, sourced at end of this file)

#-------------------------------------------------------------------------------
# User & Git Configuration
#-------------------------------------------------------------------------------
export GIT_AUTHOR_NAME="{{ .github_user_name }}"
export GIT_AUTHOR_EMAIL="{{ .github_user_email }}"
export GIT_COMMITTER_NAME="{{ .github_user_name }}"
export GIT_COMMITTER_EMAIL="{{ .github_user_email }}"
export USER_NAME="{{ .github_user_name }}"
export USER_EMAIL="{{ .github_user_email }}"

#-------------------------------------------------------------------------------
# Platform-Specific Paths
#-------------------------------------------------------------------------------
{{- if eq .chezmoi.os "darwin" }}
export HOMEBREW_PREFIX="/opt/homebrew"
export HOMEBREW_CELLAR="/opt/homebrew/Cellar"
export HOMEBREW_REPOSITORY="/opt/homebrew"
{{- else if eq .chezmoi.os "linux" }}
export HOMEBREW_PREFIX="/home/linuxbrew/.linuxbrew"
export HOMEBREW_CELLAR="/home/linuxbrew/.linuxbrew/Cellar"
export HOMEBREW_REPOSITORY="/home/linuxbrew/.linuxbrew/Homebrew"
{{- end }}

#-------------------------------------------------------------------------------
# XDG Base Directory Specification
#-------------------------------------------------------------------------------
export XDG_CONFIG_HOME="$HOME/.config"
export XDG_DATA_HOME="$HOME/.local/share"
export XDG_CACHE_HOME="$HOME/.cache"
export XDG_STATE_HOME="$HOME/.local/state"

#-------------------------------------------------------------------------------
# Editor & Pager
#-------------------------------------------------------------------------------
export EDITOR="nvim"
export VISUAL="nvim"
export PAGER="less"
export LESS="-R"

#-------------------------------------------------------------------------------
# Tool-Specific Paths
#-------------------------------------------------------------------------------
export PNPM_HOME="$HOME/Library/pnpm"

#-------------------------------------------------------------------------------
# Environment URLs (Non-Sensitive)
#-------------------------------------------------------------------------------
export DEV="https://dev-radioedit.ihrint.com"
export STAGE="https://radioedit.ihrint.com"
export PROD="https://radioedit.iheart.com"

#-------------------------------------------------------------------------------
# Platform Info (useful for conditional logic in scripts)
#-------------------------------------------------------------------------------
export CHEZMOI_OS="{{ .chezmoi.os }}"
export CHEZMOI_ARCH="{{ .chezmoi.arch }}"

#-------------------------------------------------------------------------------
# Secrets from Bitwarden (loaded from cached file)
#-------------------------------------------------------------------------------
# Secrets are fetched from Bitwarden only when the secret list changes
# This is MUCH faster than fetching on every chezmoi apply
#
# How it works:
# 1. Secret names are listed in ~/.local/share/chezmoi/dot_config/bitwarden/vars.txt
# 2. run_onchange_after_bitwarden-secrets.sh hashes that file
# 3. When the hash changes (secret added/removed), script fetches all secrets via rbw
# 4. Secrets are written to ~/.zsh_gnohj_env.secrets
# 5. This file sources that secrets file
#
# To add a new secret:
# 1. Add it to Bitwarden: rbw add SECRET_NAME --folder env-vars
# 2. Add SECRET_NAME to ~/.local/share/chezmoi/dot_config/bitwarden/vars.txt
# 3. Run: rbw sync && chezmoi apply
# 4. The run_onchange script will auto-fetch the new secret

# Source secrets file if it exists
if [ -f "$HOME/.zsh_gnohj_env.secrets" ]; then
  source "$HOME/.zsh_gnohj_env.secrets"
fi

#-------------------------------------------------------------------------------
# Machine-Specific Overrides (Optional)
#-------------------------------------------------------------------------------
# Source local overrides if they exist (for secrets not in bitwarden)
# Create ~/.zsh_gnohj_env.local and add to .gitignore
if [ -f "$HOME/.zsh_gnohj_env.local" ]; then
  source "$HOME/.zsh_gnohj_env.local"
fi
