#!/usr/bin/env bash

echo "
ğŸ”§ Run OnChange [After] Dotfiles Applied Starting........"

echo "--- CHEZMOI DEBUG ---"
echo "Username:     {{ .chezmoi.username }}"
echo "Host Name:    {{ .chezmoi.hostname }}"
echo "Home Directory: {{ .chezmoi.homeDir }}"
echo "Source Directory: {{ .chezmoi.sourceDir }}"
echo "OS Detected:   {{ .chezmoi.os }}"
echo "Arch Detected: {{ .chezmoi.arch }}"
echo "-------------------------"

{{- if ne .chezmoi.os "darwin" }}
echo "ğŸš§ Skipping post-dotfiles setup (not macOS)
"
exit 0
{{- end }}

#-------------------------------------------------------------------------------
#--                      Spicetify Theme
#-------------------------------------------------------------------------------
if ! command -v spicetify &>/dev/null; then
  echo "âŒ  spicetify not found"
else
  echo "Installing spicetify themes..."

  if [ ! -d "$HOME/.config/spicetify/Themes/Dribbblish" ]; then
    if [ ! -d "/tmp/spicetify-themes" ]; then
      git clone --depth=1 https://github.com/spicetify/spicetify-themes.git /tmp/spicetify-themes
    fi

    mkdir -p ~/.config/spicetify/Themes
    cp -r /tmp/spicetify-themes/* ~/.config/spicetify/Themes/

    rm -rf /tmp/spicetify-themes

    echo "âœ…  Spicetify themes installed"
  else
    echo "â­ï¸  Spicetify themes already installed"
  fi

  spicetify config current_theme Dribbblish
  spicetify config color_scheme gruvbox-material-dark
  spicetify backup apply

  echo "âœ…  Spicetify theme configured: Dribbblish (gruvbox-material-dark)"
fi

#-------------------------------------------------------------------------------
#--                      Summary
#-------------------------------------------------------------------------------
echo ""
echo "ğŸ“‹ Post-Dotfiles Configuration Summary:"
echo "âœ… Configured:"
echo "  â€¢ Spicetify theme: $(command -v spicetify >/dev/null 2>&1 && [ -d "/Applications/Spotify.app" ] && echo "âœ… Applied" || echo "âŒ Skipped")"
echo ""
echo "ğŸ‰ Run OnChange [After] Dotfiles Applied Complete!"
